==== 一、C程序存储空间布局 ====

C语言一直有下列部分组成： \\ 

正文段 － CPU 执行的机器指令部分；一个程序只有一个副本；只读，防止程序由于意外而修改自身指令；\\ 

初始化数据段(数据段) － 在程序中所有赋了初值的全局变量，存放在这里。 \\ 

非初始化数据段(bss段) － 在程序中没有初始化的全局变量；内核将此段初始化为0；\\ 

栈 － 增长方向：自顶向下增长；自动变量以及每次函数调用时所需要保存的信息(返回地址；环境信息)。 \\ 

堆 － 动态分配存储 \\ 

==== 二、面向过程程序设计中的 static ====

=== 1. 全局静态变量 ===

在全局变量之前加上关键字 static， 全局变量就被定义成为一个全局静态变量。
  * 内存中的位置：静态存储区 (静态存储区在整个程序运行期间都存在)
  * 初始化：未经初始化的全局静态变量会被程序自动初始化为0(自动对象的值是任意的，除非它被显式初始化)
  * 作用域：全局静态变量在声明它的文件之外是不可见的。准确地讲从定义之处开始到文件结尾。
看下面关于作用域的程序: \\ 
<code c>
// teststatic1.c
#include <stdio.h>
void display();                                                                        
extern int n;                                                                          
int main()                                                                             
{                                                                                      
	n = 20;                                                                            
	printf("%d\n", n);                                                                 
	display();                                                                         
	return 0;                                                                          
}	
</code>
<code c>
// teststatic2.c
#include <stdio.h>

static int n; // 定义全局静态变量，自动初始化为0，仅在本文件中可见                     

void display()                                                                         
{                                                                                      
	n++;                                                                               
	printf("%d\n", n);                                                                 
} 
</code>
文件分别编译通过，但link的时候teststatic1.c 中的变量n找不到定义，产生错误。 \\ 

定义全局静态变量的好处： \\ 
<1> 不会被其他文件所访问，修改 \\ 
<2> 其他文件中可以使用相同名字的变量，不会发生冲突 \\ 

=== 2. 局部静态变量 ===

在局部变量之前加上关键字 static ，局部变量就被定义为一个局部静态变量. \\ 

<1> 内存中的位置:静态存储区 \\ 
<2> 初始化：未经初始化的全局静态变量会被程序自动初始化为0（自动对象的值是任意的，除非他被显示初始化） \\ 
<3> 作用域：作用域仍为局部作用域，当定义它的函数或者语句快结束的时候，作用域随之结束. \\ 

注： 当static 用来修饰局部变量的时候，它就改变了局部变量的存储位置，从原来的栈中改为静态存储区。但是局部静态变量在离开作用域之后，并没有被销毁，而是仍然驻留在内存当中，直到程序结束，只不过我们不能再对他进行访问。 \\ 

=== 3.静态函数 ===
在函数的返回类型前加上关键字 static ，函数就被定义成为静态函数. \\ 
函数的定义和声明默认情况下是 extern 的，但静态函数只是在声明它的文件当中可见，不能被其他文件所用。 \\ 

例如：
<code c>
//teststatic1.c
void display();
static void staticdis();
int main()
{
	display();
	staticdis();
	renturn 0;
}
</code>
<code c>
//teststatic2.c
void display()
{
	staticdis();
	printf("display() has been called \n");
}
static void staticdis()
{
	printf("staticDis() has been called\n");
}
</code>

文件分别编译通过，但是链接的时候找不到函数 staticdis() 的定义，产生错误。 \\ 

定义静态函数的好处： \\ 
<1> 其他文件中可以定义相同的函数，不会发生冲突 \\ 
<2> 静态函数不能被其他文件所用 \\ 

存储说明符 auto, register, extern, static, 对应两种存储期：自动存储期和静态存储期.  \\ 

auto 和 register 对应自动存储期。具有自动存储期的变量在进入声明该变量的程序块时被建立，它在该程序活动时存在，退出该程序块时撤销. \\ 
关键字 extern 和 static 用来说明具有静态存储期的变量和函数。用 static 声明的局部变量具有静态存储持续期，或静态范围。虽然它的值在函数调用之间保持有效，但是其名字的可视性仍限制在其局部域内。静态局部对象在程序执行到该对象的声明处时首次初始化。 \\ 

由于 static 变量的以上特性，可实现一些特定功能。 \\ 

<1> 统计次数功能 \\ 
声明函数的一个局部变量，并设为static 类型，作为一个计数器，这样函数每次被调用的时候就可以进行计数。这是统计函数被调用次数的最后办法，因为这个变量和函数息息相关，而函数可能在多个不同的地方被调用，所以从调用者的角度来统计比较困难。代码如下： \\ 
<code c>
void count();
int main()
{
	int i;
	for (i = 1; i <= 3; i++)
		count();
	return 0;
}
void count()
{
	static num = 0;
	num++;
	printf(" I have been called %d",num,"times\n");
}                                                           
</code>


C语言程序可以看成由一系列外部对象构成，这些外部对象可能是变量或函数。而内部变量是指定义在函数内部的函数参数及变量。外部变量定义在函数之外，因此可以在许多函数中使用。由于C语言不允许在一个函数中定义其他函数，因此函数本身只能是"外部的". \\ 

由于C语言代码是以文件为单位来组织的，在一个源程序源文件中，一个外部变量或函数只能在某个文件中定义一次，而其他文件可以通过extern 声明来访问它 \\ 

而static 则可以限定变量或函数为静态存储，如果用static 限定外部变量与函数，则可以将该对象的作用域限定为被编译源文件的剩余部分。通过static限定外部对象，可以达到隐藏外部对象的目的。因而，static限定的变量或函数不会在同一程序中其他文件中同名冲突。如果用static限定内部变量，则该变量从程序以开始就拥有内存，不会随其所在函数的调用和退出而分配和消失。 \\ 

C 语言中使用静态函数的好处: \\ 

<1> 静态函数会被自动分配在一个一直使用的存储区，知道退出应用程序实例，避免了调用函数时压栈出栈，速度快很多。 \\ 
<2> 关键字 "static" ，译成中文就是"静态的"， 所以内部函数又称静态函数，但此处"static" 的含义不是指存储方式，而是指对函数的作用域仅局限于本文件。 \\ 

使用内部函数的好处是: 不同的人编写不同的函数时，不用担心自己定义的函数，是否会与其他文件中的函数同名，因为同名也没有关系。 \\ 

